version: '3.8'

services:
  nginx:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: avelarsys-nginx
    extra_hosts:
      - "host.docker.internal:host-gateway"
    ports:
      - "80:80"
      - "443:443"
    restart: unless-stopped
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./ssl/cloudflare.pem:/etc/ssl/certs/cloudflare.pem:ro
      - ./ssl/cloudflare.key:/etc/ssl/private/cloudflare.key:ro
      - nginx_logs:/var/log/nginx
      - /etc/letsencrypt:/etc/letsencrypt:ro
      - /var/www/certbot:/var/www/certbot:ro
      - ./app.avelarcompany.com.br.conf:/etc/nginx/conf.d/app.avelarcompany.com.br.conf:ro
      - ./avadmin.avelarcompany.com.br.conf:/etc/nginx/conf.d/avadmin.avelarcompany.com.br.conf:ro
      - /home/avelarsys/AvelarSys/AxCellOS-Docker/AxcellOs:/var/www/axcellos:ro
      - ./avax.avelarcompany.dev.br.conf:/etc/nginx/conf.d/avax.avelarcompany.dev.br.conf:ro
      - /var/www/phpmyadmin:/var/www/phpmyadmin:ro
      - ./banco.avelarcompany.dev.br.conf:/etc/nginx/conf.d/banco.avelarcompany.dev.br.conf:ro
      - ./stocktech.avelarcompany.com.br.conf:/etc/nginx/conf.d/stocktech.avelarcompany.com.br.conf:ro
      - ./wppc.avelarcompany.dev.br.conf:/etc/nginx/conf.d/wppc.avelarcompany.dev.br.conf:ro
      - ./axcellos.avelarcompany.com.br.conf:/etc/nginx/conf.d/axcellos.avelarcompany.com.br.conf:ro
      - ./turbozap.avelarcompany.com.br.conf:/etc/nginx/conf.d/turbozap.avelarcompany.com.br.conf:ro
      - ./amo.avelarcompany.dev.br.conf:/etc/nginx/conf.d/amo.avelarcompany.dev.br.conf:ro
    networks:
      - avelarsys-network
      - supabase_default
    healthcheck:
      test: ["CMD-SHELL", "curl -4fsS --max-time 5 http://127.0.0.1/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  avelarsys-network:
    external: true
  supabase_default:
    external: true

volumes:
  nginx_logs:
    name: avelarsys-nginx-logs
