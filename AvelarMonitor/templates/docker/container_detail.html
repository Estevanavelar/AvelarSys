{% extends 'base.html' %}

{% block title %}{{ container.name }} - Docker{% endblock %}

{% block content %}
<h1 class="mb-4">{{ container.name }}</h1>

<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Informações</h5>
            </div>
            <div class="card-body">
                <p><strong>ID:</strong> {{ container.id }}</p>
                <p><strong>Imagem:</strong> {{ container.image }}</p>
                <p><strong>Status:</strong> <span class="badge bg-{% if container.status == 'running' %}success{% else %}secondary{% endif %}">{{ container.status }}</span></p>
                <p><strong>Criado:</strong> {{ container.created }}</p>
                {% if container.health %}
                <p><strong>Health:</strong> <span class="badge bg-{% if container.health == 'healthy' %}success{% else %}warning{% endif %}">{{ container.health }}</span></p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Ações</h5>
            </div>
            <div class="card-body">
                {% if container.status == 'running' %}
                    <button class="btn btn-warning me-2" onclick="containerAction('stop')">Stop</button>
                    <button class="btn btn-secondary me-2" onclick="containerAction('restart')">Restart</button>
                {% else %}
                    <button class="btn btn-success me-2" onclick="containerAction('start')">Start</button>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h5 class="mb-0">Logs</h5>
    </div>
    <div class="card-body">
        <pre style="max-height: 400px; overflow-y: auto; background: #f8f9fa; padding: 15px; border-radius: 5px;">{% for log in container.logs %}{{ log }}
{% empty %}Nenhum log disponível{% endfor %}</pre>
    </div>
</div>

<a href="{% url 'docker' %}" class="btn btn-secondary mt-3">Voltar</a>
{% endblock %}

{% block extra_js %}
<script>
let confirmCallback = null;

function ensureConfirmModal() {
    if (document.getElementById('confirm-modal')) return;
    const modal = document.createElement('div');
    modal.id = 'confirm-modal';
    modal.style.cssText = 'position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.5);z-index:9999;';
    modal.innerHTML = `
      <div style="background:#fff;border-radius:12px;max-width:420px;width:90%;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.2)">
        <h5 style="margin:0 0 8px 0">Confirmar ação</h5>
        <p id="confirm-message" style="margin:0 0 16px 0;color:#555"></p>
        <div style="display:flex;justify-content:flex-end;gap:8px">
          <button id="confirm-cancel" class="btn btn-secondary btn-sm">Cancelar</button>
          <button id="confirm-ok" class="btn btn-primary btn-sm">Confirmar</button>
        </div>
      </div>`;
    document.body.appendChild(modal);
    document.getElementById('confirm-cancel').onclick = () => closeConfirm(false);
    document.getElementById('confirm-ok').onclick = () => closeConfirm(true);
}

function showConfirm(message, onConfirm) {
    ensureConfirmModal();
    confirmCallback = onConfirm;
    document.getElementById('confirm-message').textContent = message;
    document.getElementById('confirm-modal').style.display = 'flex';
}

function closeConfirm(confirmed) {
    document.getElementById('confirm-modal').style.display = 'none';
    if (confirmed && typeof confirmCallback === 'function') {
        confirmCallback();
    }
    confirmCallback = null;
}

function showToast(message) {
    const toast = document.createElement('div');
    toast.textContent = message;
    toast.style.cssText = 'position:fixed;bottom:20px;right:20px;background:#1f2937;color:#fff;padding:10px 14px;border-radius:8px;font-size:13px;z-index:9999;opacity:0;transition:opacity .2s';
    document.body.appendChild(toast);
    requestAnimationFrame(() => toast.style.opacity = '1');
    setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 200); }, 5000);
}

function containerAction(action) {
    showConfirm(`Tem certeza que deseja ${action} este container?`, () => {
        fetch('{% url "container_action" container.id %}', {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'action=' + action
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                showToast('Erro: ' + data.error);
            }
        });
    });
}
</script>
{% endblock %}

